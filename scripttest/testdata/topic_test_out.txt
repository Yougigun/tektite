set max_line_width 300;
OK

-- create topic with 1 partition, so we can see messages consumed in offset order;
topic1 := (topic partitions = 1);
OK

--produce data dataset_1;

(scan all from topic1) -> (sort by key);
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| offset               | event_time                 | key                                                                             | hdrs                                                                            | val                                                                             |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 0                    | 2006-01-02 15:04:05.000000 | key01                                                                           | .                                                                               | {"v0": 1000,"v1": 1.23,"v2": true,"v3": "12345678.7654321","v4": "foobar01",".. |
| 1                    | 2006-01-02 15:05:05.000000 | key02                                                                           | .                                                                               | {"v0": 1001,"v1": 2.23,"v2": false,"v3": "22345678.7654321","v4": "foobar02",.. |
| 2                    | 2006-01-02 15:06:05.000000 | key03                                                                           | .                                                                               | {"v0": 1002,"v1": 3.23,"v2": true,"v3": "32345678.7654321","v4": "foobar03",".. |
| 3                    | 2006-01-02 15:07:05.000000 | key04                                                                           | .                                                                               | {"v0": 1003,"v1": 4.23,"v2": false,"v3": "42345678.7654321","v4": "foobar04",.. |
| 4                    | 2006-01-02 15:08:05.000000 | key05                                                                           | .                                                                               | {"v0": 1004,"v1": 5.23,"v2": true,"v3": "52345678.7654321","v4": "foobar05",".. |
| 5                    | 2006-01-02 15:09:05.000000 | key06                                                                           | .                                                                               | {"v0": 1005,"v1": 6.23,"v2": false,"v3": "62345678.7654321","v4": "foobar06",.. |
| 6                    | 2006-01-02 15:10:05.000000 | key07                                                                           | .                                                                               | {"v0": 1006,"v1": 7.23,"v2": true,"v3": "72345678.7654321","v4": "foobar07",".. |
| 7                    | 2006-01-02 15:11:05.000000 | key08                                                                           | .                                                                               | {"v0": 1007,"v1": 8.23,"v2": false,"v3": "82345678.7654321","v4": "foobar08",.. |
| 8                    | 2006-01-02 15:12:05.000000 | key09                                                                           | .                                                                               | {"v0": 1008,"v1": 9.23,"v2": true,"v3": "92345678.7654321","v4": "foobar09",".. |
| 9                    | 2006-01-02 15:13:05.000000 | key10                                                                           | .                                                                               | {"v0": 1009,"v1": 10.23,"v2": false,"v3": "102345678.7654321","v4": "foobar10.. |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

--consume data topic1 test_group1 earliest 5 commit;
partition offset key headers value timestamp
0 1 key01  {"v0": 1000,"v1": 1.23,"v2": true,"v3": "12345678.7654321","v4": "foobar01","v5": "somebytes01","v6": "2008-04-03 23:21:17.123"} 2006-01-02 15:04:05.000000
0 2 key02  {"v0": 1001,"v1": 2.23,"v2": false,"v3": "22345678.7654321","v4": "foobar02","v5": "somebytes02","v6": "2008-04-03 23:22:17.123"} 2006-01-02 15:05:05.000000
0 3 key03  {"v0": 1002,"v1": 3.23,"v2": true,"v3": "32345678.7654321","v4": "foobar03","v5": "somebytes03","v6": "2008-04-03 23:23:17.123"} 2006-01-02 15:06:05.000000
0 4 key04  {"v0": 1003,"v1": 4.23,"v2": false,"v3": "42345678.7654321","v4": "foobar04","v5": "somebytes04","v6": "2008-04-03 23:24:17.123"} 2006-01-02 15:07:05.000000
0 5 key05  {"v0": 1004,"v1": 5.23,"v2": true,"v3": "52345678.7654321","v4": "foobar05","v5": "somebytes05","v6": "2008-04-03 23:25:17.123"} 2006-01-02 15:08:05.000000

--restart cluster;

set max_line_width 300;
OK

-- offset should be persisted between restarts;

--consume data topic1 test_group1 earliest 5 commit;
partition offset key headers value timestamp
0 6 key06  {"v0": 1005,"v1": 6.23,"v2": false,"v3": "62345678.7654321","v4": "foobar06","v5": "somebytes06","v6": "2008-04-03 23:26:17.123"} 2006-01-02 15:09:05.000000
0 7 key07  {"v0": 1006,"v1": 7.23,"v2": true,"v3": "72345678.7654321","v4": "foobar07","v5": "somebytes07","v6": "2008-04-03 23:27:17.123"} 2006-01-02 15:10:05.000000
0 8 key08  {"v0": 1007,"v1": 8.23,"v2": false,"v3": "82345678.7654321","v4": "foobar08","v5": "somebytes08","v6": "2008-04-03 23:28:17.123"} 2006-01-02 15:11:05.000000
0 9 key09  {"v0": 1008,"v1": 9.23,"v2": true,"v3": "92345678.7654321","v4": "foobar09","v5": "somebytes09","v6": "2008-04-03 23:29:17.123"} 2006-01-02 15:12:05.000000
0 10 key10  {"v0": 1009,"v1": 10.23,"v2": false,"v3": "102345678.7654321","v4": "foobar10","v5": "somebytes10","v6": "2008-04-03 23:30:17.123"} 2006-01-02 15:13:05.000000

delete(topic1);
OK

-- deploy topic with all args to check parsing;

topic1 := (topic partitions = 1 retention = 5m watermark_type = event_time watermark_lateness = 1s watermark_idle_timeout = 1m);
OK

--produce data dataset_1;

--consume data topic1 test_group1 earliest 10 commit;
partition offset key headers value timestamp
0 1 key01  {"v0": 1000,"v1": 1.23,"v2": true,"v3": "12345678.7654321","v4": "foobar01","v5": "somebytes01","v6": "2008-04-03 23:21:17.123"} 2006-01-02 15:04:05.000000
0 2 key02  {"v0": 1001,"v1": 2.23,"v2": false,"v3": "22345678.7654321","v4": "foobar02","v5": "somebytes02","v6": "2008-04-03 23:22:17.123"} 2006-01-02 15:05:05.000000
0 3 key03  {"v0": 1002,"v1": 3.23,"v2": true,"v3": "32345678.7654321","v4": "foobar03","v5": "somebytes03","v6": "2008-04-03 23:23:17.123"} 2006-01-02 15:06:05.000000
0 4 key04  {"v0": 1003,"v1": 4.23,"v2": false,"v3": "42345678.7654321","v4": "foobar04","v5": "somebytes04","v6": "2008-04-03 23:24:17.123"} 2006-01-02 15:07:05.000000
0 5 key05  {"v0": 1004,"v1": 5.23,"v2": true,"v3": "52345678.7654321","v4": "foobar05","v5": "somebytes05","v6": "2008-04-03 23:25:17.123"} 2006-01-02 15:08:05.000000
0 6 key06  {"v0": 1005,"v1": 6.23,"v2": false,"v3": "62345678.7654321","v4": "foobar06","v5": "somebytes06","v6": "2008-04-03 23:26:17.123"} 2006-01-02 15:09:05.000000
0 7 key07  {"v0": 1006,"v1": 7.23,"v2": true,"v3": "72345678.7654321","v4": "foobar07","v5": "somebytes07","v6": "2008-04-03 23:27:17.123"} 2006-01-02 15:10:05.000000
0 8 key08  {"v0": 1007,"v1": 8.23,"v2": false,"v3": "82345678.7654321","v4": "foobar08","v5": "somebytes08","v6": "2008-04-03 23:28:17.123"} 2006-01-02 15:11:05.000000
0 9 key09  {"v0": 1008,"v1": 9.23,"v2": true,"v3": "92345678.7654321","v4": "foobar09","v5": "somebytes09","v6": "2008-04-03 23:29:17.123"} 2006-01-02 15:12:05.000000
0 10 key10  {"v0": 1009,"v1": 10.23,"v2": false,"v3": "102345678.7654321","v4": "foobar10","v5": "somebytes10","v6": "2008-04-03 23:30:17.123"} 2006-01-02 15:13:05.000000

delete(topic1);
OK
