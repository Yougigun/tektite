set max_line_width 300;
OK
--create topic test_topic 16;

stream1 :=
(bridge from
    test_topic
    partitions = 16
    props = ()
)
-> (store stream);
OK

-- should fail - invalid field;
stream2 := stream1
-> (project foo)
-> (store stream);
unknown column 'foo'. (available columns: offset: int, event_time: timestamp, key: bytes, hdrs: bytes, val: bytes) (line 2 column 13):
-> (project foo)
            ^

-- should fail - offset is always present in stream;
stream2 := stream1
-> (project offset)
-> (store stream);
cannot specify column 'offset' in projection, the columns 'offset' and 'event_time' will always be included in the projection (line 2 column 13):
-> (project offset)
            ^

-- should fail - event_time is always present in stream;
stream2 := stream1
-> (project event_time)
-> (store stream);
cannot specify column 'event_time' in projection, the columns 'offset' and 'event_time' will always be included in the projection (line 2 column 13):
-> (project event_time)
            ^

stream2 := stream1
-> (project
    key,
    event_time as event_time2,
    offset as offset2,
    json_int("v0",val) as v0,
    json_float("v1",val) as v1,
    json_bool("v2",val) as v2,
    to_decimal(json_string("v3", val),38,6) as v3,
    json_string("v4", val) as v4,
    to_bytes(json_string("v5", val)) as v5,
    parse_date(json_string("v6", val), "2006-01-02 15:04:05.999999") as v6)
-> (store stream);
OK

-- columns in different order;

stream3 := stream2
-> (project v6, v0, v5, v1, v4, v2, v3)
-> (store stream);
OK

-- test default column naming for expressions;

stream4 := stream2
-> (project to_string(v0), to_string(v1), to_string(v2))
-> (store stream);
OK

-- test aliases;

stream5 := stream2
-> (project v0 as ff0, v1 as ff1, v2 as ff2)
-> (store stream);
OK

-- should fail -cannot alias as offset;

stream6 := stream2
-> (project v0 as offset)
-> (store stream);
cannot use alias 'offset', it is a reserved name (line 2 column 19):
-> (project v0 as offset)
                  ^

-- should fail -cannot alias as event_time;

stream6 := stream2
-> (project v0 as event_time)
-> (store stream);
cannot use alias 'event_time', it is a reserved name (line 2 column 19):
-> (project v0 as event_time)
                  ^


--load data dataset_1;

(scan all from stream2) -> (sort by key);
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| offset               | event_time                 | key                  | event_time2                | offset2              | v0                   | v1                   | v2                   | v3                   | v4                   | v5                   | v6                         |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 0                    | 2006-01-02 15:04:05.000000 | key01                | 2006-01-02 15:04:05.000000 | 0                    | 1000                 | 1.230000             | true                 | 12345678.765432      | foobar01             | somebytes01          | 2008-04-03 23:21:17.123000 |
| 0                    | 2006-01-02 15:05:05.000000 | key02                | 2006-01-02 15:05:05.000000 | 0                    | 1001                 | 2.230000             | false                | 22345678.765432      | foobar02             | somebytes02          | 2008-04-03 23:22:17.123000 |
| 0                    | 2006-01-02 15:06:05.000000 | key03                | 2006-01-02 15:06:05.000000 | 0                    | 1002                 | 3.230000             | true                 | 32345678.765432      | foobar03             | somebytes03          | 2008-04-03 23:23:17.123000 |
| 0                    | 2006-01-02 15:07:05.000000 | key04                | 2006-01-02 15:07:05.000000 | 0                    | 1003                 | 4.230000             | false                | 42345678.765432      | foobar04             | somebytes04          | 2008-04-03 23:24:17.123000 |
| 0                    | 2006-01-02 15:08:05.000000 | key05                | 2006-01-02 15:08:05.000000 | 0                    | 1004                 | 5.230000             | true                 | 52345678.765432      | foobar05             | somebytes05          | 2008-04-03 23:25:17.123000 |
| 0                    | 2006-01-02 15:09:05.000000 | key06                | 2006-01-02 15:09:05.000000 | 0                    | 1005                 | 6.230000             | false                | 62345678.765432      | foobar06             | somebytes06          | 2008-04-03 23:26:17.123000 |
| 0                    | 2006-01-02 15:10:05.000000 | key07                | 2006-01-02 15:10:05.000000 | 0                    | 1006                 | 7.230000             | true                 | 72345678.765432      | foobar07             | somebytes07          | 2008-04-03 23:27:17.123000 |
| 1                    | 2006-01-02 15:11:05.000000 | key08                | 2006-01-02 15:11:05.000000 | 1                    | 1007                 | 8.230000             | false                | 82345678.765432      | foobar08             | somebytes08          | 2008-04-03 23:28:17.123000 |
| 0                    | 2006-01-02 15:12:05.000000 | key09                | 2006-01-02 15:12:05.000000 | 0                    | 1008                 | 9.230000             | true                 | 92345678.765432      | foobar09             | somebytes09          | 2008-04-03 23:29:17.123000 |
| 0                    | 2006-01-02 15:13:05.000000 | key10                | 2006-01-02 15:13:05.000000 | 0                    | 1009                 | 10.230000            | false                | 102345678.765432     | foobar10             | somebytes10          | 2008-04-03 23:30:17.123000 |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

(scan all from stream3) -> (sort by v0);
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| offset               | event_time                 | v6                         | v0                   | v5                                   | v1                                   | v4                                   | v2                                   | v3                                   |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 0                    | 2006-01-02 15:04:05.000000 | 2008-04-03 23:21:17.123000 | 1000                 | somebytes01                          | 1.230000                             | foobar01                             | true                                 | 12345678.765432                      |
| 0                    | 2006-01-02 15:05:05.000000 | 2008-04-03 23:22:17.123000 | 1001                 | somebytes02                          | 2.230000                             | foobar02                             | false                                | 22345678.765432                      |
| 0                    | 2006-01-02 15:06:05.000000 | 2008-04-03 23:23:17.123000 | 1002                 | somebytes03                          | 3.230000                             | foobar03                             | true                                 | 32345678.765432                      |
| 0                    | 2006-01-02 15:07:05.000000 | 2008-04-03 23:24:17.123000 | 1003                 | somebytes04                          | 4.230000                             | foobar04                             | false                                | 42345678.765432                      |
| 0                    | 2006-01-02 15:08:05.000000 | 2008-04-03 23:25:17.123000 | 1004                 | somebytes05                          | 5.230000                             | foobar05                             | true                                 | 52345678.765432                      |
| 0                    | 2006-01-02 15:09:05.000000 | 2008-04-03 23:26:17.123000 | 1005                 | somebytes06                          | 6.230000                             | foobar06                             | false                                | 62345678.765432                      |
| 0                    | 2006-01-02 15:10:05.000000 | 2008-04-03 23:27:17.123000 | 1006                 | somebytes07                          | 7.230000                             | foobar07                             | true                                 | 72345678.765432                      |
| 1                    | 2006-01-02 15:11:05.000000 | 2008-04-03 23:28:17.123000 | 1007                 | somebytes08                          | 8.230000                             | foobar08                             | false                                | 82345678.765432                      |
| 0                    | 2006-01-02 15:12:05.000000 | 2008-04-03 23:29:17.123000 | 1008                 | somebytes09                          | 9.230000                             | foobar09                             | true                                 | 92345678.765432                      |
| 0                    | 2006-01-02 15:13:05.000000 | 2008-04-03 23:30:17.123000 | 1009                 | somebytes10                          | 10.230000                            | foobar10                             | false                                | 102345678.765432                     |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

(scan all from stream4) -> (sort by col0);
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| offset               | event_time                 | col0                                                                            | col1                                                                            | col2                                                                            |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 0                    | 2006-01-02 15:04:05.000000 | 1000                                                                            | 1.23                                                                            | true                                                                            |
| 0                    | 2006-01-02 15:05:05.000000 | 1001                                                                            | 2.23                                                                            | false                                                                           |
| 0                    | 2006-01-02 15:06:05.000000 | 1002                                                                            | 3.23                                                                            | true                                                                            |
| 0                    | 2006-01-02 15:07:05.000000 | 1003                                                                            | 4.23                                                                            | false                                                                           |
| 0                    | 2006-01-02 15:08:05.000000 | 1004                                                                            | 5.23                                                                            | true                                                                            |
| 0                    | 2006-01-02 15:09:05.000000 | 1005                                                                            | 6.23                                                                            | false                                                                           |
| 0                    | 2006-01-02 15:10:05.000000 | 1006                                                                            | 7.23                                                                            | true                                                                            |
| 1                    | 2006-01-02 15:11:05.000000 | 1007                                                                            | 8.23                                                                            | false                                                                           |
| 0                    | 2006-01-02 15:12:05.000000 | 1008                                                                            | 9.23                                                                            | true                                                                            |
| 0                    | 2006-01-02 15:13:05.000000 | 1009                                                                            | 10.23                                                                           | false                                                                           |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

(scan all from stream5) -> (sort by ff0);
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| offset               | event_time                 | ff0                  | ff1                                                                                                           | ff2                                                                                                           |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 0                    | 2006-01-02 15:04:05.000000 | 1000                 | 1.230000                                                                                                      | true                                                                                                          |
| 0                    | 2006-01-02 15:05:05.000000 | 1001                 | 2.230000                                                                                                      | false                                                                                                         |
| 0                    | 2006-01-02 15:06:05.000000 | 1002                 | 3.230000                                                                                                      | true                                                                                                          |
| 0                    | 2006-01-02 15:07:05.000000 | 1003                 | 4.230000                                                                                                      | false                                                                                                         |
| 0                    | 2006-01-02 15:08:05.000000 | 1004                 | 5.230000                                                                                                      | true                                                                                                          |
| 0                    | 2006-01-02 15:09:05.000000 | 1005                 | 6.230000                                                                                                      | false                                                                                                         |
| 0                    | 2006-01-02 15:10:05.000000 | 1006                 | 7.230000                                                                                                      | true                                                                                                          |
| 1                    | 2006-01-02 15:11:05.000000 | 1007                 | 8.230000                                                                                                      | false                                                                                                         |
| 0                    | 2006-01-02 15:12:05.000000 | 1008                 | 9.230000                                                                                                      | true                                                                                                          |
| 0                    | 2006-01-02 15:13:05.000000 | 1009                 | 10.230000                                                                                                     | false                                                                                                         |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

delete(stream5);
OK
delete(stream4);
OK
delete(stream3);
OK
delete(stream2);
OK
delete(stream1);
OK

--delete topic test_topic;
